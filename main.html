<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-Ray Multi-Disease Predictor</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* (Style code is same as uploaded main.html, omitted for brevity) */
        /* ... */

        /* Base Styling */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f4f8; 
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* Header */
        .header {
            width: 100%;
            background-color: #007bff;
            color: white;
            padding: 25px 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        /* Main Container */
        .main-container {
            display: flex;
            width: 90%;
            max-width: 1200px;
            margin: 40px auto;
            gap: 30px;
            flex-wrap: wrap; 
        }

        /* Card/Section Styling */
        .card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 20px;
        }

        /* (Rest of the CSS is assumed to be correct) */
        /* ... */
    </style>
</head>
<body>
    <div class="header">
        <h1>X-Ray Multi-Disease Prediction (AI Diagnosis)</h1>
        <p>Advanced Deep Learning for 5 X-Ray Conditions: Pneumonia, TB, Lung Cancer, Bone Fracture, and Normal.</p>
    </div>

    <div class="main-container">
        <div class="card upload-section">
            <h2>1. X-Ray Image Upload</h2>
            <form id="uploadForm" enctype="multipart/form-data">
                <input type="file" id="fileInput" name="file" accept="image/png, image/jpeg, image/jpg">
                
                <label for="fileInput" class="file-label">üìÇ Select X-Ray Image</label>
                
                <img id="imagePreview" src="#" alt="Image Preview"/>
                
                <button type="submit" id="predictButton">üöÄ Predict Disease</button>
            </form>
        </div>

        <div class="card result-section">
            <h2>2. Diagnosis Result</h2>
            <div id="result-display">
                <p>Please upload an X-ray image on the left and click the 'Predict' button to start the AI analysis.</p>
            </div>
            
            <div class="disclaimer">
                <strong>üí° Disclaimer:</strong> This is a sophisticated AI tool, but **it is not a replacement for a doctor**. Always consult a qualified medical professional for final diagnosis and treatment plans.
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileInput');
        const resultDiv = document.getElementById('result-display');
        const imagePreview = document.getElementById('imagePreview');
        const predictButton = document.getElementById('predictButton');
        
        // Disease information dictionary (for 5 classes)
        const DISEASE_INFO = {
            'pneumonia': {
                title: "Pneumonia (‡§´‡•Å‡§´‡•ç‡§´‡•Å‡§∏‡§æ‡§ö‡§æ ‡§∏‡§Ç‡§∏‡§∞‡•ç‡§ó)",
                color: "#d9534f", // Red
                description: "‡§´‡•Å‡§´‡•ç‡§´‡•Å‡§∏‡§æ‡§§‡•Ä‡§≤ ‡§π‡§µ‡§æ ‡§≠‡§∞‡§≤‡•á‡§≤‡•ç‡§Ø‡§æ ‡§≤‡§π‡§æ‡§® ‡§™‡§ø‡§∂‡§µ‡•ç‡§Ø‡§æ‡§Ç‡§Æ‡§ß‡•ç‡§Ø‡•á (Air Sacs) ‡§∏‡§Ç‡§∏‡§∞‡•ç‡§ó‡§æ‡§Æ‡•Å‡§≥‡•á ‡§™‡§æ‡§£‡•Ä ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§™‡•Ç ‡§ú‡§Æ‡§æ ‡§π‡•ã‡§£‡•á.",
                next_step: "‡§≤‡§ó‡•á‡§ö ‡§ú‡§®‡§∞‡§≤ ‡§´‡§ø‡§ú‡§ø‡§∂‡§ø‡§Ø‡§® (General Physician) ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§™‡§≤‡•ç‡§Æ‡•ã‡§®‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü (Pulmonologist) ‡§Ø‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ‡§∂‡•Ä ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§∏‡§æ‡§ß‡§æ‡§µ‡§æ."
            },
            'tb': {
                title: "Tuberculosis (TB) - ‡§ï‡•ç‡§∑‡§Ø‡§∞‡•ã‡§ó",
                color: "#f0ad4e", // Orange
                description: "‡§ú‡•Ä‡§µ‡§æ‡§£‡•Ç‡§Ç‡§Æ‡•Å‡§≥‡•á ‡§π‡•ã‡§£‡§æ‡§∞‡§æ ‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§Ü‡§£‡§ø ‡§∏‡§Ç‡§∏‡§∞‡•ç‡§ó‡§ú‡§®‡•ç‡§Ø ‡§∞‡•ã‡§ó, ‡§ú‡•ã ‡§™‡•ç‡§∞‡§æ‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§æ‡§®‡•á ‡§´‡•Å‡§´‡•ç‡§´‡•Å‡§∏‡§æ‡§Ç‡§µ‡§∞ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§ï‡§∞‡§§‡•ã.",
                next_step: "‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ü‡§∞‡•ã‡§ó‡•ç‡§Ø ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§æ‡§§ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§ú‡§®‡§∞‡§≤ ‡§´‡§ø‡§ú‡§ø‡§∂‡§ø‡§Ø‡§®‡§ï‡§°‡•Ç‡§® ‡§§‡§™‡§æ‡§∏‡§£‡•Ä ‡§ï‡§∞‡•Ç‡§® ‡§ò‡•ç‡§Ø‡§æ‡§µ‡•Ä."
            },
            'lung_cancer': {
                title: "Lung Cancer (‡§´‡•Å‡§´‡•ç‡§´‡•Å‡§∏‡§æ‡§ö‡§æ ‡§ï‡§∞‡•ç‡§ï‡§∞‡•ã‡§ó)",
                color: "#292b2c", // Dark Gray
                description: "‡§´‡•Å‡§´‡•ç‡§´‡•Å‡§∏‡§æ‡§Ç‡§Æ‡§ß‡•Ä‡§≤ ‡§™‡•á‡§∂‡•Ä‡§Ç‡§ö‡•Ä ‡§Ö‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§µ‡§æ‡§¢.",
                next_step: "‡§ë‡§®‡§ï‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü (Oncologist) ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§™‡§≤‡•ç‡§Æ‡•ã‡§®‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü ‡§Ø‡§æ‡§Ç‡§ö‡§æ ‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§∏‡§≤‡•ç‡§≤‡§æ ‡§ò‡•ç‡§Ø‡§æ‡§µ‡§æ."
            },
            'bone_fracture': {
                title: "Bone Fracture (‡§π‡§æ‡§° ‡§Æ‡•ã‡§°‡§£‡•á)",
                color: "#5cb85c", // Green
                description: "‡§π‡§æ‡§°‡§æ‡§≤‡§æ ‡§§‡§°‡§æ ‡§ú‡§æ‡§£‡•á ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§π‡§æ‡§° ‡§™‡•Ç‡§∞‡•ç‡§£‡§™‡§£‡•á ‡§Æ‡•ã‡§°‡§£‡•á.",
                next_step: "‡§ë‡§∞‡•ç‡§•‡•ã‡§™‡•á‡§°‡§ø‡§ï ‡§∏‡§∞‡•ç‡§ú‡§® (Orthopedic Surgeon) ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§Ü‡§™‡§§‡•ç‡§ï‡§æ‡§≤‡•Ä‡§® ‡§µ‡§ø‡§≠‡§æ‡§ó‡§æ‡§§ (Emergency) ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§∏‡§æ‡§ß‡§æ‡§µ‡§æ."
            },
            'normal': { // Normal class added
                title: "Normal (‡§∞‡•ã‡§ó ‡§Ü‡§¢‡§≥‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä)",
                color: "#007bff", // Blue
                description: "‡§∏‡§ß‡•ç‡§Ø‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§Æ‡•â‡§°‡•á‡§≤‡§ö‡•ç‡§Ø‡§æ ‡§Ö‡§Ç‡§¶‡§æ‡§ú‡§æ‡§®‡•Å‡§∏‡§æ‡§∞, ‡§è‡§ï‡•ç‡§∏-‡§∞‡•á ‡§´‡§ï‡•ç‡§§ ‡§§‡•ç‡§Ø‡§æ ‡§∞‡•ã‡§ó‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä predict ‡§ï‡§∞‡•á‡§≤ ‡§ú‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§Æ‡•â‡§°‡•á‡§≤ ‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§ø‡§§ ‡§Ü‡§π‡•á . ",
                next_step: "‡§§‡§∞‡•Ä‡§π‡•Ä, ‡§°‡•â‡§ï‡•ç‡§ü‡§∞‡§æ‡§Ç‡§ï‡§°‡•Ç‡§® ‡§è‡§ï‡§¶‡§æ ‡§§‡§™‡§æ‡§∏‡§£‡•Ä ‡§ï‡§∞‡•Ç‡§® ‡§ò‡•á‡§£‡•á ‡§®‡•á‡§π‡§Æ‡•Ä‡§ö ‡§ö‡§æ‡§Ç‡§ó‡§≤‡•á ‡§Ö‡§∏‡§§‡•á."
            }
        };


        // 1. Show preview when image is selected
        fileInput.onchange = evt => {
            const [file] = fileInput.files;
            if (file) {
                imagePreview.src = URL.createObjectURL(file);
                imagePreview.style.display = 'block';
                resultDiv.innerHTML = "<p>‚úÖ Image selected successfully. Click 'Predict Disease' to analyze.</p>"; 
            } else {
                imagePreview.style.display = 'none';
            }
        };

        // 2. Handle form submission (Prediction)
        form.onsubmit = async (e) => {
            e.preventDefault(); 
            
            if (!fileInput.files[0]) {
                resultDiv.innerHTML = "<p style='color:red;'>‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï‡•ç‡§∏-‡§∞‡•á ‡§á‡§Æ‡•á‡§ú ‡§®‡§ø‡§µ‡§°‡§æ.</p>";
                return;
            }

            // Loading state
            predictButton.disabled = true;
            resultDiv.innerHTML = '<div class="loader"></div> <p style="color:#007bff; display: inline; font-weight: 500;">AI Analysis in progress... Please wait...</p>';
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                // Call the backend '/predict' API
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    const predictionClass = data.prediction.toLowerCase().replace(/ /g, '_'); 
                    const info = DISEASE_INFO[predictionClass] || {
                        title: data.prediction,
                        color: "#6c757d",
                        description: "‡§Ø‡§æ ‡§∞‡•ã‡§ó‡§æ‡§¨‡§¶‡•ç‡§¶‡§≤‡§ö‡•Ä ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä.",
                        next_step: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞‡§æ‡§Ç‡§ö‡§æ ‡§∏‡§≤‡•ç‡§≤‡§æ ‡§ò‡•ç‡§Ø‡§æ."
                    };
                    
                    const confidenceValue = parseFloat(data.confidence.replace('%', ''));

                    // Display successful result in HTML format
                    resultDiv.innerHTML = `
                        <p><strong>Diagnosis Time:</strong> ${data.time}</p>
                        <div class="prediction-text" style="color: ${info.color};">
                            ‚úÖ Predicted Condition: ${info.title}
                        </div>
                        <p><strong>Confidence Score:</strong> ${data.confidence}</p>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidenceValue}%; background-color: ${info.color};"></div>
                        </div>
                        <hr style="margin: 15px 0;">
                        <p><strong>‡§∞‡•ã‡§ó‡§æ‡§¨‡§¶‡•ç‡§¶‡§≤ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä:</strong> ${info.description}</p>
                        <p><strong>‡§™‡•Å‡§¢‡•Ä‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§µ‡§æ‡§π‡•Ä:</strong> <span style="font-weight: 600; color: #dc3545;">${info.next_step}</span></p>
                    `;

                } else {
                    // Server/Model Error
                    resultDiv.innerHTML = `<p style="color:red;">‚ùå ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä (Error): ${data.error || '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä.'}</p>`;
                }
            } catch (error) {
                // Network Error
                resultDiv.innerHTML = `<p style="color:red;">‚ùå ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä (Network Error): ‡§∏‡§∞‡•ç‡§µ‡§∞‡§∂‡•Ä ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§∏‡§æ‡§ß‡§§‡§æ ‡§Ü‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä. Flask ‡§ö‡§æ‡§≤‡§§ ‡§Ü‡§π‡•á ‡§ï‡•Ä ‡§®‡§æ‡§π‡•Ä, ‡§π‡•á ‡§§‡§™‡§æ‡§∏‡§æ.</p>`;
            } finally {
                predictButton.disabled = false;
            }
        };
    </script>
</body>
</html>